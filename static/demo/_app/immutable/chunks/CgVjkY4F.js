import{i as e,R as f,l as u}from"./DSoDdw3M.js";var r;(function(n){n[n.Audio=1]="Audio",n[n.Cache=2]="Cache",n[n.Config=3]="Config",n[n.Data=4]="Data",n[n.LocalData=5]="LocalData",n[n.Document=6]="Document",n[n.Download=7]="Download",n[n.Picture=8]="Picture",n[n.Public=9]="Public",n[n.Video=10]="Video",n[n.Resource=11]="Resource",n[n.Temp=12]="Temp",n[n.AppConfig=13]="AppConfig",n[n.AppData=14]="AppData",n[n.AppLocalData=15]="AppLocalData",n[n.AppCache=16]="AppCache",n[n.AppLog=17]="AppLog",n[n.Desktop=18]="Desktop",n[n.Executable=19]="Executable",n[n.Font=20]="Font",n[n.Home=21]="Home",n[n.Runtime=22]="Runtime",n[n.Template=23]="Template"})(r||(r={}));async function L(){return e("plugin:path|resolve_directory",{directory:r.AppConfig})}async function R(){return e("plugin:path|resolve_directory",{directory:r.AppData})}async function U(){return e("plugin:path|resolve_directory",{directory:r.Temp})}async function b(...n){return e("plugin:path|join",{paths:n})}async function h(n){return e("plugin:path|dirname",{path:n})}var c;(function(n){n[n.Start=0]="Start",n[n.Current=1]="Current",n[n.End=2]="End"})(c||(c={}));function p(n){return{isFile:n.isFile,isDirectory:n.isDirectory,isSymlink:n.isSymlink,size:n.size,mtime:n.mtime!==null?new Date(n.mtime):null,atime:n.atime!==null?new Date(n.atime):null,birthtime:n.birthtime!==null?new Date(n.birthtime):null,readonly:n.readonly,fileAttributes:n.fileAttributes,dev:n.dev,ino:n.ino,mode:n.mode,nlink:n.nlink,uid:n.uid,gid:n.gid,rdev:n.rdev,blksize:n.blksize,blocks:n.blocks}}function w(n){const i=new Uint8ClampedArray(n),t=i.byteLength;let a=0;for(let s=0;s<t;s++){const l=i[s];a*=256,a+=l}return a}class g extends f{async read(i){if(i.byteLength===0)return 0;const t=await e("plugin:fs|read",{rid:this.rid,len:i.byteLength}),a=w(t.slice(-8)),s=t instanceof ArrayBuffer?new Uint8Array(t):t;return i.set(s.slice(0,s.length-8)),a===0?null:a}async seek(i,t){return await e("plugin:fs|seek",{rid:this.rid,offset:i,whence:t})}async stat(){const i=await e("plugin:fs|fstat",{rid:this.rid});return p(i)}async truncate(i){await e("plugin:fs|ftruncate",{rid:this.rid,len:i})}async write(i){return await e("plugin:fs|write",{rid:this.rid,data:i})}}async function m(n,i){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");const t=await e("plugin:fs|open",{path:n instanceof URL?n.toString():n,options:i});return new g(t)}async function A(n,i){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");await e("plugin:fs|mkdir",{path:n instanceof URL?n.toString():n,options:i})}async function x(n,i){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");return await e("plugin:fs|read_dir",{path:n instanceof URL?n.toString():n,options:i})}async function T(n,i){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");const t=await e("plugin:fs|read_text_file",{path:n instanceof URL?n.toString():n,options:i}),a=t instanceof ArrayBuffer?t:Uint8Array.from(t);return new TextDecoder().decode(a)}async function k(n,i){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");await e("plugin:fs|remove",{path:n instanceof URL?n.toString():n,options:i})}async function C(n,i,t){if(n instanceof URL&&n.protocol!=="file:"||i instanceof URL&&i.protocol!=="file:")throw new TypeError("Must be a file URL.");await e("plugin:fs|rename",{oldPath:n instanceof URL?n.toString():n,newPath:i instanceof URL?i.toString():i,options:t})}async function v(n,i,t){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");if(i instanceof ReadableStream){const a=await m(n,{read:!1,create:!0,write:!0,...t}),s=i.getReader();try{for(;;){const{done:l,value:d}=await s.read();if(l)break;await a.write(d)}}finally{s.releaseLock(),await a.close()}}else await e("plugin:fs|write_file",i,{headers:{path:encodeURIComponent(n instanceof URL?n.toString():n),options:JSON.stringify(t)}})}async function E(n,i,t){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");const a=new TextEncoder;await e("plugin:fs|write_text_file",a.encode(i),{headers:{path:encodeURIComponent(n instanceof URL?n.toString():n),options:JSON.stringify(t)}})}async function S(n,i){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");return await e("plugin:fs|exists",{path:n instanceof URL?n.toString():n,options:i})}async function F(n,i){return await o.load(n,i)}class o extends f{constructor(i){super(i)}static async load(i,t){const a=await e("plugin:store|load",{path:i,options:t});return new o(a)}static async get(i){return await e("plugin:store|get_store",{path:i}).then(t=>t?new o(t):null)}async set(i,t){await e("plugin:store|set",{rid:this.rid,key:i,value:t})}async get(i){const[t,a]=await e("plugin:store|get",{rid:this.rid,key:i});return a?t:void 0}async has(i){return await e("plugin:store|has",{rid:this.rid,key:i})}async delete(i){return await e("plugin:store|delete",{rid:this.rid,key:i})}async clear(){await e("plugin:store|clear",{rid:this.rid})}async reset(){await e("plugin:store|reset",{rid:this.rid})}async keys(){return await e("plugin:store|keys",{rid:this.rid})}async values(){return await e("plugin:store|values",{rid:this.rid})}async entries(){return await e("plugin:store|entries",{rid:this.rid})}async length(){return await e("plugin:store|length",{rid:this.rid})}async reload(i){await e("plugin:store|reload",{rid:this.rid,...i})}async save(){await e("plugin:store|save",{rid:this.rid})}async onKeyChange(i,t){return await u("store://change",a=>{a.payload.resourceId===this.rid&&a.payload.key===i&&t(a.payload.exists?a.payload.value:void 0)})}async onChange(i){return await u("store://change",t=>{t.payload.resourceId===this.rid&&i(t.payload.key,t.payload.exists?t.payload.value:void 0)})}}export{R as a,x as b,T as c,h as d,S as e,C as f,L as g,v as h,b as j,F as l,A as m,k as r,U as t,E as w};
