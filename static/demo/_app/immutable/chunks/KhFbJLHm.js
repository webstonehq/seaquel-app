var a=Object.defineProperty;var l=(o,t,n)=>t in o?a(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var s=(o,t,n)=>l(o,typeof t!="symbol"?t+"":t,n);import{_ as u}from"./BiEFbFql.js";class h{constructor(){s(this,"id","duckdb");s(this,"db",null);s(this,"connections",new Map);s(this,"initialized",!1);s(this,"initPromise",null)}isAvailable(){return typeof window<"u"&&!("__TAURI__"in window)}async initialize(){if(!this.initialized){if(this.initPromise)return this.initPromise;this.initPromise=this.doInitialize(),await this.initPromise}}async doInitialize(){const t=await u(()=>import("./CYAVp77O.js"),[],import.meta.url),n=t.getJsDelivrBundles(),i=await t.selectBundle(n),e=URL.createObjectURL(new Blob([`importScripts("${i.mainWorker}");`],{type:"text/javascript"})),r=new Worker(e),c=new t.ConsoleLogger;this.db=new t.AsyncDuckDB(c,r),await this.db.instantiate(i.mainModule,i.pthreadWorker),this.initialized=!0}async connect(t){if(await this.initialize(),!this.db)throw new Error("DuckDB not initialized");const n=`duckdb-${Date.now()}`,i=await this.db.connect();return this.connections.set(n,i),n}async disconnect(t){const n=this.connections.get(t);n&&(await n.close(),this.connections.delete(t))}async select(t,n,i){const e=this.connections.get(t);if(!e)throw new Error(`Connection not found: ${t}`);return(await e.query(n)).toArray().map(c=>c.toJSON())}async execute(t,n,i){const e=this.connections.get(t);if(!e)throw new Error(`Connection not found: ${t}`);return{rowsAffected:(await e.query(n)).numRows}}async test(t){if(await this.initialize(),!this.db)throw new Error("DuckDB not initialized");await(await this.db.connect()).close()}async executeRaw(t,n){const i=this.connections.get(t);if(!i)throw new Error(`Connection not found: ${t}`);await i.query(n)}getDb(){return this.db}getConnection(t){return this.connections.get(t)}}export{h as DuckDBProvider};
