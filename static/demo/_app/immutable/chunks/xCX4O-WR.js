var a=Object.defineProperty;var l=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var o=(e,t,n)=>l(e,typeof t!="symbol"?t+"":t,n);import{_ as u}from"./DDoSWvZY.js";class h{constructor(){o(this,"id","duckdb");o(this,"db",null);o(this,"connections",new Map);o(this,"initialized",!1);o(this,"initPromise",null)}isAvailable(){return typeof window<"u"&&!("__TAURI__"in window)}async initialize(){if(!this.initialized){if(this.initPromise)return this.initPromise;this.initPromise=this.doInitialize(),await this.initPromise}}async doInitialize(){const t=await u(()=>import("./CYAVp77O.js"),[],import.meta.url),n=t.getJsDelivrBundles(),i=await t.selectBundle(n),s=URL.createObjectURL(new Blob([`importScripts("${i.mainWorker}");`],{type:"text/javascript"})),r=new Worker(s),c=new t.ConsoleLogger;this.db=new t.AsyncDuckDB(c,r),await this.db.instantiate(i.mainModule,i.pthreadWorker),this.initialized=!0}async connect(t){if(await this.initialize(),!this.db)throw new Error("DuckDB not initialized");const n=`duckdb-${Date.now()}`,i=await this.db.connect();return this.connections.set(n,i),n}async disconnect(t){const n=this.connections.get(t);n&&(await n.close(),this.connections.delete(t))}async select(t,n){const i=this.connections.get(t);if(!i)throw new Error(`Connection not found: ${t}`);return(await i.query(n)).toArray().map(r=>r.toJSON())}async execute(t,n,i){const s=this.connections.get(t);if(!s)throw new Error(`Connection not found: ${t}`);return{rowsAffected:(await s.query(n)).numRows}}async test(t){if(await this.initialize(),!this.db)throw new Error("DuckDB not initialized");await(await this.db.connect()).close()}async executeRaw(t,n){const i=this.connections.get(t);if(!i)throw new Error(`Connection not found: ${t}`);await i.query(n)}getDb(){return this.db}getConnection(t){return this.connections.get(t)}}export{h as DuckDBProvider};
